<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Details</title>
  <link href="/styles/output.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .content-section {
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <%- include('../partials/user/newheader.ejs') %>
    <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="flex flex-col md:flex-row gap-8">
        <!-- Sidebar -->
        <%- include('../partials/user/myaccountSidebar.ejs') %>
          <!-- Main Content -->
          <main
            class="flex-1 bg-white rounded-lg shadow-lg border border-gray-200 transition-all duration-300 hover:shadow-xl">
            <div class="px-6 py-4 border-b border-gray-200">
              <nav class="flex items-center space-x-2 text-sm text-gray-500">
                <a href="/" class="hover:text-gray-700">Home</a>
                <i class="ri-arrow-right-s-line"></i>
                <i class="ri-arrow-right-s-line"></i>
                <span id="breadcrumb-current" class="text-gray-900">Order List</span>
              </nav>
            </div>
            <div class="p-6 content-section">
              <a href="/account/profile" class="text-blue-600 hover:underline text-sm mb-4 inline-block">&larr; Back to
                profile</a>
              <% if (order) { %>
                <% order.reverse().forEach(function(orderItem) { %>
                  <% const orderId=orderItem.orderId %>
                    <% const status=orderItem.status ? orderItem.status.toLowerCase() : '' ; %>
                      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                        <!-- Product Preview Row -->
                        <% if (orderItem.orderedItems && orderItem.orderedItems.length> 0) { %>
                          <div class="flex items-center gap-4 mb-4">
                            <div>
                              <div class="font-semibold text-gray-800 text-base">
                              </div>
                              <% if (orderItem.orderedItems.length> 1) { %>
                                <% } %>
                            </div>
                          </div>
                          <% } %>
                            <div class="flex flex-row items-center mb-4 gap-2">
                              <div class="flex-1 space-y-1">
                                <div class="text-sm text-gray-500">Order ID: <span class="font-medium text-gray-700">
                                    <%= orderItem.orderId %>
                                  </span></div>
                                <div class="text-sm text-gray-500">Order Date: <span class="text-gray-700">
                                    <%= orderItem.createdOn %>
                                  </span></div>
                                <div class="text-sm text-gray-500">Payment: <span class="text-gray-700">
                                    <%= orderItem.paymentMethod %>
                                  </span></div>
                                  <% if(orderItem.address){ %>
                                    
                                <div class="text-sm text-gray-500">Shipping Address: <span class="text-gray-700">
                                   <%= orderItem.address.address %>, <%= orderItem.address.city %>, <%= orderItem.address.district %>
                                                                , <%= orderItem.address.state %> - <%= orderItem.address.pinCode %>
                                  </span></div>
                                 
                                  <% } %>
                              </div>
                              <div class="flex flex-col items-end text-right gap-2 mt-2 md:mt-0">
                                <span class="inline-block px-3 py-1 rounded-full text-xs font-medium
                        <%= status === 'pending' ? 'bg-red-100 text-red-700' :
                            status === 'shipped' ? 'bg-yellow-100 text-yellow-700' :
                            status === 'delivered' ? 'bg-green-100 text-green-700' :
                            status === 'cancelled' ? 'bg-red-100 text-red-700' :
                            status === 'returned' ? 'bg-yellow-100 text-yellow-700' :
                            'bg-gray-100 text-gray-700' %>">
                                  <%= orderItem.status %>
                                </span>
                                <div class="text-lg font-semibold text-gray-800">₹<%= orderItem?.totalPrice %>
                                </div>
                              </div>
                            </div>
                            <div class="border-t border-gray-100 pt-4">
                              <div class="space-y-4">
                                <% if (orderItem.orderedItems && Array.isArray(orderItem.orderedItems)) { %>
                                    <% orderItem.orderedItems.forEach(function(item) { %>
                                        <div class="flex items-center justify-between bg-gray-50 rounded-md p-3 border border-gray-100">
                                            <div class="flex items-center gap-3">
                                                <img src="<%= item.productId?.productImage?.[0]?.url %>"
                                                    alt="<%= item.productId?.productName %>"
                                                    class="w-10 h-10 object-cover rounded border border-gray-200">
                                                <div>
                                                    <div class="font-medium text-gray-800">
                                                        <%= item.productId?.productName %>
                                                    </div>
                                                    <div class="text-xs text-gray-500">Qty: <%= item.quantity %></div>
                                                    <div class="text-xs text-gray-500">Price: ₹<%= item.price %></div>
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-end gap-2">
                                                <div class="text-gray-700 font-semibold">₹<%= (item.price * item.quantity).toFixed(2) %></div>
                                                <span class="text-xs font-medium
                                                    <%= item.status === 'Pending' ? 'text-red-700' :
                                                        item.status === 'Shipped' ? 'text-yellow-700' :
                                                        item.status === 'Delivered' ? 'text-green-700' :
                                                        item.status === 'Cancelled' ? 'text-red-500' :
                                                        item.status === 'Returned' ? 'text-yellow-500' :
                                                        'text-gray-600' %>">
                                                    <%= item.status %>
                                                </span>
                                            </div>
                                        </div>
                                    <% }); %>
                                <% } else { %>
                                    <div>No items found for this order.</div>
                                <% } %>
                              </div>
                            </div>
                            <%if(order){ %>
                              <div class="mt-6 flex flex-wrap gap-3 justify-end">
                                <a href="/orders/details/?orderId=<%= orderId|| '' %>"
                                  class="inline-block bg-blue-600 border border-blue-800 text-white px-4 py-2 rounded font-bold shadow hover:bg-blue-800 hover:text-white">View
                                  Details</a>
                                <% } %>
                                  <% if (status==='returned' ) { %>
                                    <span
                                      class="px-5 py-2 rounded bg-yellow-100 text-yellow-600 font-medium border border-yellow-200">Order
                                      Returned</span>
                                    <% } %>
                                      <a href="/orders/<%= orderId %>/invoice"
                                        class="px-5 py-2 rounded bg-blue-600 text-white font-medium hover:bg-blue-700 transition">Download
                                        Invoice</a>
                              </div>
                      </div>
                      <% }); %>
                        <% } else { %>
                          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6 text-center">
                            <p>No orders found.</p>
                          </div>
                          <% } %>
            </div>
          </main>
      </div>
    </div>

</body>

</html>